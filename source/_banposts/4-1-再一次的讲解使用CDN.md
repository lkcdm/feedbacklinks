---
title: 再一次的讲解使用CDN
abbrlink: 2024/8/25/1
date: 2024/8/25 22:00:00
updated: 2024/9/13 14:00:00
tags:
- CDN
- 教程
categories:
- 其他内容
copyright: true
toc_number: false
cover: https://koimg.cn-sy1.rains3.com/2024/08/28/045686.webp
businesscard: true
---

# 前提

> 依旧是前提，我为什么会写这篇文章？

![image-20240825183512843](https://koimg.cn-sy1.rains3.com/2024/08/25/696850.webp)

很多人在使用CDN的时候，都会出现各种问题，比如：`502`等`5xx`报错等，一般都是个人配置、服务器设置、防火墙出问题，所以我打算写一个全面的各各情况出现的问题，以及如何解决，希望可以解决大伙99%的问题！同时如果需要补充错误可以留言投稿例子给我，我会完善文章的解决措施，和例子！

{% link QiuDN | 免费给博主提供CDN服务 ,  QiuDN·加速防护-减少负载 , https://www.qiudcdn.cn %}

# 使用

首先，先学会如何去使用，QiuDN目前是基于[LeCDN高性能系统](https://www.woyw.com/knowledgebaseview?id=58)系统运作的，相对于常见的系统，如cdnfly、GoEdge等有更好的抗攻击能力，独家URL级CC防御规则，开启后，只对被攻击URL进行人机认证，不影响其他页面访问，提高用户体验，高并发、高可用性。

![image-20240825193402050](https://koimg.cn-sy1.rains3.com/2024/08/25/775213.webp)

## 添加站点

首先，先确保您开通了订单，没有订单是没法直接添加站点的，同时要注意，订单期限结束会删除站点，添加订单前请确保有足够开订单的余额，或申请公益活动

{% link 为博客站点提供免费 CDN | 朽丘博 ,  可以为初创博主以及开源程序提供免费的 CDN 防护 , https://koxiuqiu.cn/2024/04/06/qiudn/ %}

> 后续前端可能会更新优化前台UI，操作大差不差

![image-20240825193622474](https://koimg.cn-sy1.rains3.com/2024/08/25/157477.webp)

然后依次点击，展开站点，点击站点列表，切换页面后点击添加站点

![image-20240825194028528](https://koimg.cn-sy1.rains3.com/2024/08/25/881302.webp)

然后选择你的订单，然后再填写你的域名

![image-20240825194149877](https://koimg.cn-sy1.rains3.com/2024/08/25/354819.webp)

然后点击源站，填写你的源服务器的IP，当然，添加站点后在添加IP也是同理（如果是域名需要注意的是可能会问题,比如说你套了cf然后用cf的解析又套cdn是不可行的，套双盾不是这么套用的）

> 调试了负载方式、负载方式，除外否则权重高低不重要

![image-20240825194346647](https://koimg.cn-sy1.rains3.com/2024/08/25/447267.webp)

然后就可以进入站点管理了，这里描述着详细的CDN站点信息

![image-20240825195213099](https://koimg.cn-sy1.rains3.com/2024/08/25/932630.webp)

操作到这里并不代表着您已经套用CDN了，还需把系统给的CNAME解析添加\替换上

> 电子文盲请点击键盘的CTRL+W关闭网页并退出使用，添加站点然后不添加解析就甩锅给CDN说没用的人不在少数！

![image-20240825195508975](https://koimg.cn-sy1.rains3.com/2024/08/25/630831.webp)

![image-20240825195820071](https://koimg.cn-sy1.rains3.com/2024/08/25/422866.webp)

到这里才是真正使用上了CDN，等待DNS服务器完全响应即可！

## 进阶操作

接下来就是更进一步的配置，分为：

- 源站管理
- 配置管理
- SSL安全
- 缓存配置
- WAF配置

### 源站管理

![image-20240825200111831](https://koimg.cn-sy1.rains3.com/2024/08/25/129811.webp)

第一个就是源站管理，如果前面您前面添加站点并没有填写添加源站，这时候再补充就行，或更换

![image-20240825200250470](https://koimg.cn-sy1.rains3.com/2024/08/25/480940.webp)

负载方式无特殊需求请默认即可，如果程序有其他需求就按照要求更改

![image-20240825200330954](https://koimg.cn-sy1.rains3.com/2024/08/25/160660.webp)

回源协议划个重点！

很多情况下，很多人配置完发现网站回源不上的问题，就是因为此处配置错误

![image-20240825200631629](https://koimg.cn-sy1.rains3.com/2024/08/25/009834.webp)

如果源站没有开启SSL/没有证书，则是选择HTTP然后点击更新即可，如果开启了SSL可以选择跟随/HTTPS

> 需要保证的是源站服务器和CDN需要使用的是同一个证书密匙，后面会讲

这样基本的源站设置就完成了，下面的没特殊需求别乱动乱调，如果有需求按照要求调试，或者自己琢磨，如果有问题就别折腾，或者加入站长交流群沟通(文章最下方名片添加)，**首先，klcdm无义务手把手解答**

![image-20240825201410129](https://koimg.cn-sy1.rains3.com/2024/08/25/660669.webp)

### 配置管理

![image-20240825201458037](https://koimg.cn-sy1.rains3.com/2024/08/25/483790.webp)

此处非常简单，没特殊需求别乱开就行，不是说设置全开网站就无敌/安全了，如果是静态单页开了数据实时可能会导致网站直接无法访问

是否开启GZIP？

> gzip是GNUzip的缩写，HTTP协议上的gzip编码是一种用来改进web应用程序性能的技术，web服务器和客户端（浏览器）必须共同支持gzip。目前主流的浏览器，Chrome,firefox,IE等都支持该协议。常见的服务器如Apache，Nginx，IIS同样支持gzip
>
> gzip压缩比率在3到10倍左右，可以大大节省服务器的网络带宽。而在实际应用中，并不是对所有文件进行压缩，通常只是压缩静态文件

最简单直接的做法就是，开了有问题就关了就行！

### SSL安全

![image-20240825202126498](https://koimg.cn-sy1.rains3.com/2024/08/25/454518.webp)

如果想网站支持https协议访问(及443端口)，让网站数据加密更安全，可以直接点击SSL证书申请即可，CDN系统会帮助您一键申请，当然也可能会申请失败，多次尝试即可！申请成功后就可以在此处点击申请成功的证书然后点击更新即可！想查看证书或者自己添加证书点击站点中的证书管理即可！

![image-20240825202250756](https://koimg.cn-sy1.rains3.com/2024/08/25/436756.webp)

TLS版本可以选择1.2、1.3，TLS V1.0 | 1.1存在安全漏洞

跳转可以选择跟随或者跳转到HTTPS，下方的设置无特殊需求，开启一个HTTP2即可

![image-20240825202750888](https://koimg.cn-sy1.rains3.com/2024/08/25/995116.webp)

### 缓存配置

CDN在创建一个站点会自动添加一个缓存配置了，如果发现网站出现问题可以删除/自行配置需求即可

![image-20240825202853751](https://koimg.cn-sy1.rains3.com/2024/08/25/491127.webp)

至于开不开缓存，减少延迟和提高资源访问效率，自己选择

### WAF配置

分为三个小配置：

- 人机验证
- CC防护
- 高级配置

#### 人机验证

一般情况下，可以选择不开，因为这个设置是强制开启防护，也就是说无论是什么情况，请求都需要通过验证才可以，一般API、图床引用等不用开，否则影响正常使用，验证模式没什么

![image-20240825203241341](https://koimg.cn-sy1.rains3.com/2024/08/25/024240.webp)

#### CC防护

CC防护分两种触发模式，一种是URL，一种是整站；

- URL级防护：当一个页面/链接在你设置的时间内超过你设置的访问次数则需要验证，而不会影响其他页面访问服务情况
- 整站级防护：不管哪个链接等受到攻击，整站开启防护验证，访问此网站都要通过验证

选择验证方式滑动即可，大差不大，看攻击者的攻击策略，一般CC都无视，绕过除外

![image-20240825205036645](https://koimg.cn-sy1.rains3.com/2024/08/25/836392.webp)

对于策略，如果只是单页，一个资源请求下来并不多无脑的：访问次数20-访问频率1就行

给一个参考值：小型服务器20-1，中型服务器50-1 / 50-5，大型服务器150-1 / 200-1

> 只是参考值，如果发现误封说明策略太严格，可以放松，放松了服务器又负载了说明你整个程序就根本不适合当前服务器的配置，比如说1核1G的服务器，你部署了halo博客系统并且套用了hao主题，你可能连itdog的快速测速的并发都无法承受，升级服务器吧别乱甩锅

高级配置中的预设规则应用你需要的，或自己设置规则

![image-20240825211223382](https://koimg.cn-sy1.rains3.com/2024/08/25/330804.webp)

> 放开您那想装的心理，规则不是全加上了网站就无敌了，全加上了影响网站出现问题一概不负责
>
> ![image-20240825213311807](https://koimg.cn-sy1.rains3.com/2024/08/25/453900.webp)

# 常见问题

- 回源错误端口

检查回源是否正常，比如回源协议，源站没开启SSL却选中了HTTPS的回源，没开你的回源端口试80就会导致cdn回源的端口试443

- 无法回源服务(504)

源服务器被攻击，导致宕机等，请检查服务器，或者联系服务商更换IP，详细阅读：[使用 CDN 后如何保护源站不泄露 ](https://koxiuqiu.cn/2024/05/12/1715500241877/)

![image-20240920222921580](https://koimg.cn-sy1.rains3.com/2024/09/20/631857.webp)

## 直接报错不安全

![image-20240825215758432](https://koimg.cn-sy1.rains3.com/2024/08/25/047963.webp)

直接反馈给管理员，并使用按下win+R输入cmd，输入ping 域名查看节点IP记录下来，或者itdog.cn测速查看有哪个节点是不正常加载

## 为什么感觉接入 CDN 变慢
检查你的服务器回源到 CDN 是否很慢，超时，并优化回源速度，比如北美服务器换成亚太服务器（CDN有待优化耐心等待）

## 不断重定向
检查一下回源问题，假设 wp　博客程序出现此情况，请在源站服务器也开启 SSL 支持，并调整回源为 HTTPS 模式，更新，不要拿CF的设置套用在其他cdn上，不适配，出现问题联系管理员帮你配置

## 突然没法访问 CDN 控制台/网站
你可以是被拉黑了等其他问题，使用魔法上网刷新 IP 或者是过一段时间访问即可！

如果是自己的网站调整策略，可能是太严了影响了访客正常访问

## 504情况二
如果你是CF等集群托管的，那么你是想我的CDN节点回源到哪里呢，是没法直接解析回源到你的“目的地”的，不存在这种玩法，节点和不同系统节点之间数据不统一，如果用了其他集群了就别折腾其他的，或者获取一台服务器可以直接解析指向的

## 网站测速会出现一部分502

检查你的配置，是不是开了源站健康，不懂配置就关了，是健康的问题，节点检测到源ip异常下线了

## cf添加cdn解析无法正常访问/访问部分报错

切换国内DNS解析商，华为国际版，阿里云，腾讯云；切换后还出现问题在联系管理员，暂不解决其他DNS服务器解析服务平台问题，博主不了解海外解析平台的设置

{% tip warning faa-horizontal animated %}最后警告一遍，不懂不了解的配置别他**的乱开，真要骂人了{% endtip %}

> 在此，欢迎投稿问题，我会进行文章更新补充，欢迎查漏补缺，文章有纠正及时留言通知！